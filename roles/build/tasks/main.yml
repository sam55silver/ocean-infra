---
- name: Build Docker Image Locally
  community.docker.docker_image_build:
    name: "{{ registry_server }}/{{ image_name }}:{{ image_tag }}"
    path: "{{ image_path }}"

- name: Tag Docker Image with latest
  community.docker.docker_image_tag:
    name: "{{ registry_server }}/{{ image_name }}:{{ image_tag }}"
    repository:
      - "{{ registry_server }}/{{ image_name }}:latest"

- name: Push Image to Registry
  community.docker.docker_image_push:
    name: "{{ registry_server }}/{{ image_name }}:{{ image_tag }}"
    use_ssh_client: true
